@page "/contacts"
@rendermode InteractiveServer
@using FluentValidation
@inject IValidator<IQuickOrder> Validator
@inject ISnackbar Snackbar

<MudGrid Class="mt-6 mb-10" Justify="Justify.Center">

    <MudItem xs="12" md="6">
        <MudPaper Elevation="1" Class="pa-4 mb-4">

            <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="2" Class="mb-3">
                <MudIcon Icon="@Icons.Material.Filled.SupportAgent" Size="Size.Large" Class="mr-2"/>
                <MudText Typo="Typo.h2">Контакти Class Kedr</MudText>
            </MudStack>

            <MudList T="string" Dense="true">
                <MudListItem T="string">
                    <MudStack Row="true">
                        <MudIcon Icon="@Icons.Material.Filled.Phone" Class="mr-2"/>
                        <MudText Typo="Typo.body1">
                            <a href="tel:+38(068)713-50-49">+38 (068) 713-50-493</a>
                        </MudText>
                    </MudStack>
                </MudListItem>
                <MudListItem T="string">
                    <MudStack Row="true">
                        <MudIcon Icon="@Icons.Material.Filled.Email" Class="mr-2"/>
                        <MudText Typo="Typo.body1"><a href="mailto:info@classkedr.ua">info@kedr.ua</a></MudText>
                    </MudStack>
                </MudListItem>
            </MudList>

            <MudDivider Class="mt-5 mb-10"/>

            <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="2" Class="mb-3">
                <MudIcon Icon="@Icons.Material.Filled.Schedule" Size="Size.Large" Class="mr-2"/>
                <MudText Typo="Typo.h3">Графік роботи</MudText>
            </MudStack>

            <MudTable Items="@_schedule" Dense="true" Hover="false" Bordered="true">
                <HeaderContent>
                    <MudTh>Дні</MudTh>
                    <MudTh>Час</MudTh>
                </HeaderContent>
                <RowTemplate>
                    <MudTd DataLabel="Дні">@context.Day</MudTd>
                    <MudTd DataLabel="Час"><strong>@context.Hours</strong></MudTd>
                </RowTemplate>
            </MudTable>

            <MudAlert Severity="MudBlazor.Severity.Info" Variant="Variant.Outlined" Class="mt-10 mb-2">
                Приймаємо оплату у гривнях і USD. Доставка по Україні «Нова Пошта», доступний самовивіз.
            </MudAlert>
        </MudPaper>
    </MudItem>

    <MudItem xs="12" md="6">
        <MudPaper Elevation="1" Class="pa-4">
            <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="2" Class="mb-3">
                <MudIcon Icon="@Icons.Material.Filled.MailOutline" Size="Size.Large" Class="mr-2"/>
                <MudText Typo="Typo.h2">Зворотний зв’язок</MudText>
            </MudStack>
            <MudText Typo="Typo.body1" Class="mb-3">
                Вкажіть ваше ім’я та телефон. Менеджер зв’яжеться з вами протягом 15 хвилин.
            </MudText>

            <MudForm Model="@_model" @ref="@_form" Validation="@(Validator.ValidateValue(_model))" ValidationDelay="0">

                <MudTextField @bind-Value="_model.Name"
                              For="()=>_model.Name"
                              InputType="InputType.Text"
                              Placeholder="Андрій"
                              DebounceInterval="500"
                              Variant="Variant.Outlined"
                              Counter="25"
                              MaxLength="25"
                              Label="Ім'я *"/>

                <MudTextField @bind-Value="_model.Phone"
                              For="()=>_model.Phone"
                              InputType="InputType.Telephone"
                              Mask="@(new PatternMask("00 000 00 00"))"
                              Placeholder="99 123 45 67"
                              Adornment="Adornment.Start"
                              AdornmentText="(+380)"
                              MaxLength="9"
                              DebounceInterval="500"
                              Variant="Variant.Outlined"
                              Label="Телефон *"/>

                <MudTextField @bind-Value="_model.Message"
                              For="()=>_model.Message"
                              Variant="Variant.Outlined"
                              Lines="5"
                              DebounceInterval="500"
                              Counter="500"
                              MaxLength="500"
                              Label="Повідомлення"/>
                <MudStack Row="true" Spacing="2" Class="mt-3">
                    <MudButton OnClick="SubmitAsync" Variant="Variant.Filled" Color="Color.Primary" StartIcon="@Icons.Material.Filled.Send">
                        Відправити
                    </MudButton>
                    <MudButton OnClick="Reset" Class="ml-2" Variant="Variant.Outlined">
                        Скинути
                    </MudButton>
                </MudStack>
            </MudForm>




        </MudPaper>
    </MudItem>
</MudGrid>

<CallToAction></CallToAction>

@code {
    private readonly List<ScheduleRow> _schedule =
    [
        new("Пн–Пт", "09:00–18:00"),
        new("Сб", "10:00–15:00"),
        new("Нд", "Вихідний"),
    ];

    private sealed record ScheduleRow(string Day, string Hours);

    private QuickOrderVm _model = new();
    private MudForm _form = null!;

    private async Task SubmitAsync()
    {
        await _form.Validate();

        if (_form.IsValid)
        {
            var request = new QuickOrderRequest(_model!.Name, _model.Phone, _model.Message);
            var command = new CreateQuickOrderCommand(request);
            await Mediator.Send(command);

            Snackbar.Configuration.PositionClass = Defaults.Classes.Position.BottomLeft;
            Snackbar.Add("📩 Ваші дані успішно відправлені. Наш менеджер зв’яжеться з вами найближчим часом.", MudBlazor.Severity.Success);

            Reset();
        }
    }

    private void Reset()
    {
        _model = new QuickOrderVm();
    }
}
