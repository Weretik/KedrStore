@inherits Fluxor.Blazor.Web.Components.FluxorComponent
@inject IState<CatalogState> CatalogState
@inject ICatalogStore CatalogStore


@if (CatalogSelectors.IsLoading(CatalogState.Value))
{
    for (int i = 0; i < CatalogState.Value.Params.PageSize; i++)
    {
        <MudGrid>
            <MudItem xs="12" md="4">
                <MudCard>
                    <MudSkeleton SkeletonType="SkeletonType.Rectangle" Height="200px"/>
                    <MudCardContent>
                        <MudSkeleton Width="30%" Height="42px;"/>
                        <MudSkeleton Width="80%"/>
                        <MudSkeleton Width="100%"/>
                    </MudCardContent>
                    <MudCardActions>
                        <MudSkeleton Width="64px" Height="40px" Class="ml-2"/>
                        <MudSkeleton Width="105px" Height="40px" Class="ml-3"/>
                    </MudCardActions>
                </MudCard>
            </MudItem>
        </MudGrid>
    }
    <MudProgressLinear Color="Color.Primary" Indeterminate="true" Class="my-7" />
}
else if (CatalogSelectors.IsEmpty(CatalogState.Value))
{
      <MudText Typo="Typo.h6" Color="Color.Warning">За даними критеріями товари не знайдено</MudText>
      <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="@CatalogStore.Reset" Class="mx-auto d-block">
          Скинути фільтри
      </MudButton>
}
else if (CatalogSelectors.HasError(CatalogState.Value))
{
    <MudText Typo="Typo.body1" Color="Color.Error">
        @CatalogSelectors.Error(CatalogState.Value)
    </MudText>
}
else
{
      <MudGrid>
          @foreach(var item in CatalogSelectors.Items(CatalogState.Value))
          {
              <MudItem xs="12" md="4">
                  <MudCard>

                      <MudCardHeader>

                          <CardHeaderContent>
                              <MudText Typo="Typo.button" Color="Color.Primary">Атрикул: @item.Id </MudText>
                          </CardHeaderContent>

                          <CardHeaderActions>
                              <MudChip T="string" Variant="Variant.Text" Color="Color.Info">Новинка</MudChip>
                          </CardHeaderActions>
                      </MudCardHeader>

                      <MudCardContent>

                          <div class="d-flex justify-center">
                              <MudImage Class="rounded-lg"
                                        ObjectFit="ObjectFit.Cover"
                                        Src="assets/images/placeholder3.png"
                                        Alt="Product"/>
                          </div>
                          <MudText Typo="Typo.h6">
                              @item.Name
                          </MudText>
                          <MudText Align="Align.End" Typo="Typo.subtitle1">
                              @item.Amount @item.Currency
                          </MudText>
                      </MudCardContent>

                      <MudCardActions>
                          <MudButton Variant="Variant.Outlined" Color="Color.Default" FullWidth="true"
                                     StartIcon="@Icons.Material.Filled.ShoppingCartCheckout">
                              Швидке замовлення
                          </MudButton>
                      </MudCardActions>

                  </MudCard>

              </MudItem>
          }
      </MudGrid>

      <MudPagination ShowFirstButton="true"
                     Size="Size.Large"
                     ShowLastButton="true"
                     Class="mt-10 mb-20"
                     Count="@CatalogSelectors.TotalPages(CatalogState.Value)"
                     @bind-Selected="CurrentPage" />
}


@code {

    protected override void OnInitialized()
    {
        base.OnInitialized();
        CatalogStore.Reload();
    }

    int CurrentPage
    {
        get => CatalogState.Value.Params.PageNumber;
        set => CatalogStore.GoToPage(value);
    }


}
